# Step3-6 通信テスト実行優先順位リスト（19時deadline対応版）

**作成日時**: 2025-11-06 12:30
**完了期限**: 2025-11-06 19:00（日本時間）
**目的**: ハードコード実装による最小限の通信テスト完了

---

## 📊 実施概要

### 対象テスト数
- **合計**: 18テスト
- **見積もり時間**: 180-270分（3-4.5時間）
- **バッファ込み**: 約6時間30分（余裕を持った計画）

### 除外した項目（実施不要）
- **Step2インターフェース連携**（TC057-TC059）: ハードコードで直接データ渡すため不要
- **Step7インターフェース連携**（TC122-TC124）: Step7仕様未確定、Step6でデータ受取確認まで
- **IPlcCommunicationManagerインターフェース契約**（TC091-TC093）: ハードコード呼び出しのため不要
- **統計累積詳細**（TC062）: TC067でカバー
- **エラー伝播詳細**（TC065）: TC068, TC069でカバー
- **ログ出力確認**（TC106-TC109）: 後から追加可能
- **ErrorHandler連携**（TC110-TC113）: 後から追加可能

---

## 🎯 Phase 1: 基本動作確認（10テスト）

**目的**: 各メソッドが単独で正しく動作することを確認
**推定時間**: 100-150分

### 1-1. 接続系メソッド（3テスト）

#### ✅ TC017: ConnectAsync_TCP接続成功
- **優先度**: ★★★★★
- **所要時間**: 10-15分
- **検証内容**:
  - TCP接続が成功すること
  - ConnectionResponse.IsSuccess == true
  - Socket.Connected == true
  - 接続時間が記録されること
- **前提条件**: PLC実機またはモックサーバー稼働中

#### ✅ TC018: ConnectAsync_UDP接続成功
- **優先度**: ★★★★★
- **所要時間**: 10-15分
- **検証内容**:
  - UDP接続が成功すること
  - ConnectionResponse.IsSuccess == true
  - UDPソケットが正しく初期化されること
- **前提条件**: UDP通信可能な環境

#### ✅ TC021: DisconnectAsync_正常切断
- **優先度**: ★★★★☆
- **所要時間**: 8-12分
- **検証内容**:
  - 接続後の正常切断
  - Socket.Connected == false
  - リソースが解放されること
- **前提条件**: TC017またはTC018が成功していること

---

### 1-2. 送受信系メソッド（3テスト）

#### ✅ TC021: SendFrameAsync_正常送信
- **優先度**: ★★★★★
- **所要時間**: 10-15分
- **検証内容**:
  - SLMPフレームが正常に送信されること
  - 送信バイト数が正しいこと
  - タイムアウトエラーが発生しないこと
- **前提条件**: TC017またはTC018が成功していること

#### ✅ TC022: SendFrameAsync_全機器データ取得
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - M000-M999（ビットデバイス）の送信成功
  - D000-D999（ワード/DWordデバイス）の送信成功
  - 複数フレーム送信の正常動作
- **前提条件**: TC021が成功していること

#### ✅ TC019: ReceiveResponseAsync_正常受信
- **優先度**: ★★★★★
- **所要時間**: 10-15分
- **検証内容**:
  - PLCからの応答受信成功
  - 受信データサイズの妥当性
  - RawResponseData構造への正しい格納
- **前提条件**: TC021が成功していること

---

### 1-3. Step6データ処理系メソッド（4テスト）

#### ✅ TC023: ProcessReceivedRawData_基本後処理成功
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-1（基本処理）が正常動作
  - BasicProcessedResponseDataへの変換成功
  - ProcessedDevices辞書に正しくデータ格納
  - エラーコードの正しい解析
- **前提条件**: TC019で受信したデータを使用

#### ✅ TC026: CombineDwordData_DWord結合処理成功
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-2（DWord結合）が正常動作
  - Low/Highワードの正しい結合
  - ProcessedResponseDataへの変換成功
  - CombinedDWordDevices辞書に正しくデータ格納
- **前提条件**: TC023が成功していること

#### ✅ TC031: ParseRawToStructuredData_3Eフレーム解析
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-3（構造化）が正常動作（3Eフレーム）
  - StructuredDataへの変換成功
  - StructuredDevices辞書に正しくデータ格納
  - フレームバージョン情報の正しい記録
- **前提条件**: TC026が成功していること

#### ✅ TC032: ParseRawToStructuredData_4Eフレーム解析
- **優先度**: ★★★★☆
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-3（構造化）が正常動作（4Eフレーム）
  - 3Eフレームとの差異を正しく処理
  - StructuredData構造への正しい変換
- **前提条件**: TC026が成功していること

---

## 🔄 Phase 2: 連続動作確認（8テスト）

**目的**: 実際の通信フローが連続して動作することを確認
**推定時間**: 80-120分

### 2-1. Step3-5連続動作（2テスト）

#### ✅ TC060: Step3to5_TCP完全サイクル正常動作
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - TCP接続→送信→受信→切断の一連の流れ
  - ConnectionStatsの統計情報更新
  - 各ステップのIsSuccess確認
- **前提条件**: Phase 1全テストが成功していること

#### ✅ TC061: Step3to5_UDP完全サイクル正常動作
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - UDP接続→送信→受信→切断の一連の流れ
  - TCPとの動作差異確認
  - タイムアウト処理の妥当性
- **前提条件**: Phase 1全テストが成功していること

---

### 2-2. Step6連続処理（2テスト）

#### ✅ TC063: Step6_ProcessToCombinetoParse連続処理
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-1→6-2→6-3の連続処理
  - 各段階のデータ型変換正常性
  - 最終的なStructuredDataの完全性
- **前提条件**: TC060またはTC061で受信したデータを使用

#### ✅ TC064: Step6_各段階データ伝達整合性 ★重要★
- **優先度**: ★★★★★
- **所要時間**: 12-18分
- **検証内容**:
  - Step6-1出力（BasicProcessedResponseData）の検証
  - Step6-2出力（ProcessedResponseData）の検証
  - Step6-3出力（StructuredData）の検証
  - **Step6でデータが正しく受け取れることの最終確認**
- **前提条件**: TC063が成功していること

---

### 2-3. Step3-6完全サイクル（4テスト）

#### ✅ TC066: FullCycle_接続から構造化まで完全実行 ★最重要★
- **優先度**: ★★★★★
- **所要時間**: 15-20分
- **検証内容**:
  - Step3（接続）→Step4（送信）→Step5（受信）→Step6（処理）の完全実行
  - 最終的なStructuredDataの妥当性
  - **通信テスト全体の成功を証明する最重要テスト**
  - ログファイル出力確認（オプション）
- **前提条件**: Phase 1, Phase 2前半全テストが成功していること
- **備考**: このテスト成功で「通信→データ取得→処理完了」を実証

#### ✅ TC067: FullCycle_複数サイクル実行時統計累積
- **優先度**: ★★★★☆
- **所要時間**: 12-18分
- **検証内容**:
  - 完全サイクルを3回連続実行
  - ConnectionStatsの累積統計確認
  - メモリリークがないこと
  - 各サイクルのIsSuccess確認
- **前提条件**: TC066が成功していること

#### ✅ TC068: FullCycle_エラー発生時の適切なスキップ
- **優先度**: ★★★★☆
- **所要時間**: 12-18分
- **検証内容**:
  - Step3エラー時、Step4-6がスキップされること
  - Step4エラー時、Step5-6がスキップされること
  - エラー情報が適切に記録されること
  - 後続サイクルに影響しないこと
- **前提条件**: TC066が成功していること

#### ✅ TC069: ErrorPropagation_Step3エラー時後続スキップ
- **優先度**: ★★★☆☆
- **所要時間**: 10-15分
- **検証内容**:
  - 接続失敗時の後続処理スキップ確認
  - エラーメッセージの伝播確認
  - リソース解放の確認
- **前提条件**: TC068が成功していること

---

## 📅 推奨実施スケジュール

```
12:30-14:00 (90分)   Phase 1前半（TC017,TC018,TC021,TC021,TC022）5テスト
                     → 接続・送受信・切断の基本動作確認

14:00-15:30 (90分)   Phase 1後半（TC019,TC023,TC026,TC031,TC032）5テスト
                     → データ処理系メソッド確認
                     → 休憩・中間レビュー

15:30-17:00 (90分)   Phase 2前半（TC060,TC061,TC063,TC064）4テスト
                     → Step3-5連続動作
                     → Step6連続処理・データ受取確認

17:00-18:30 (90分)   Phase 2後半（TC066,TC067,TC068,TC069）4テスト
                     → 完全サイクル実行
                     → ★TC066成功で通信テスト完了を宣言可能★

18:30-19:00 (30分)   最終確認・エラー修正バッファ
                     → ログ確認
                     → ドキュメント更新
```

---

## ✅ 成功判定基準

### 最小成功基準（これだけは必須）
- [ ] TC017: TCP接続成功
- [ ] TC021: 正常送信
- [ ] TC019: 正常受信
- [ ] TC023: 基本処理成功
- [ ] TC026: DWord結合成功
- [ ] TC031: 構造化成功
- [ ] **TC066: 完全サイクル実行成功** ★最重要★

### 理想的な成功基準（可能であれば）
- [ ] Phase 1全10テスト成功
- [ ] Phase 2全8テスト成功
- [ ] ログファイル出力確認
- [ ] 複数サイクル実行確認（TC067）

---

## 📝 実施時の注意事項

### テスト実行環境
- PLC実機またはモックサーバーが稼働していること
- ネットワーク接続が安定していること
- ログ出力ディレクトリ（./logs/）が存在すること

### ハードコード実装の前提
- Step2（フレーム生成）は直接コード内で実装
- Step7（出力）は未実装、Step6でデータ取得確認まで
- 設定ファイル読み込みは簡易実装またはハードコード

### Step6実装設計方針（重要）
- **Step6-2（MergeResponseData）は常に実行される**
  - 理由: 2つの応答データ（M用とD用）を統合する必要があるため
  - Random READ方式により、DWord結合処理は不要（PLCが自動的にDWord形式で返す）
  - 型安全性: Step6-3は常に`ProcessedResponseData`型を受け取る
- **処理フロー**:
  - Step6-1: `ProcessReceivedRawData()` × 2回（M用とD用を個別処理）
  - Step6-2: `MergeResponseData()` - 2つの応答を統合（**必ず実行**）
  - Step6-3: `ParseRawToStructuredData()` - 構造化変換
- **参考資料**: `documents/ToDo/step6内容検討.md`（2025-11-05検討、旧DWord分割方式からの設計変更）

### エラー発生時の対応
1. **Phase 1でエラー**: 該当メソッドのバグ修正を優先
2. **Phase 2でエラー**: Phase 1の成功を再確認後、連携部分を調査
3. **時間切迫時**: TC066のみ成功を目指す（最小成功基準）

### 記録すべき情報
- 各テストの実行時間（実測値）
- エラー内容・スタックトレース
- ログファイル出力内容（サンプル）
- 最終的なStructuredDataの構造（JSON形式）

---

## 🚀 次のステップ（19時以降に実施可能）

### 追加実装が推奨される項目
1. **ログ出力連携**（TC106-TC109）: LoggingManager統合
2. **エラーハンドリング連携**（TC110-TC113）: ErrorHandler統合
3. **Step2インターフェース化**（TC057-TC059）: ConfigToFrameManager連携
4. **Step7実装**（TC122-TC124）: DataOutputManager連携
5. **インターフェース契約定義**（TC091-TC093）: IPlcCommunicationManager正式化

### パフォーマンス最適化
- メモリ使用量測定（TC114-TC116）
- 接続プール実装
- 非同期処理の最適化

---

## 📊 進捗記録

### Phase 1: 基本動作確認（10テスト）
- [ ] TC017: ConnectAsync_TCP接続成功
- [ ] TC018: ConnectAsync_UDP接続成功
- [ ] TC021: DisconnectAsync_正常切断
- [ ] TC021: SendFrameAsync_正常送信
- [ ] TC022: SendFrameAsync_全機器データ取得
- [ ] TC019: ReceiveResponseAsync_正常受信
- [ ] TC023: ProcessReceivedRawData_基本後処理成功
- [ ] TC026: CombineDwordData_DWord結合処理成功
- [ ] TC031: ParseRawToStructuredData_3Eフレーム解析
- [ ] TC032: ParseRawToStructuredData_4Eフレーム解析

### Phase 2: 連続動作確認（8テスト）
- [ ] TC060: Step3to5_TCP完全サイクル正常動作
- [ ] TC061: Step3to5_UDP完全サイクル正常動作
- [ ] TC063: Step6_ProcessToCombinetoParse連続処理
- [ ] TC064: Step6_各段階データ伝達整合性
- [ ] TC066: FullCycle_接続から構造化まで完全実行 ★最重要★
- [ ] TC067: FullCycle_複数サイクル実行時統計累積
- [ ] TC068: FullCycle_エラー発生時の適切なスキップ
- [ ] TC069: ErrorPropagation_Step3エラー時後続スキップ

**進捗**: 0/18 (0%)
**最終更新**: 2025-11-06 12:30

---

## 🎯 このドキュメントの目的

1. **19時までの明確なゴール設定**: 18テスト完了で通信テスト完了を宣言
2. **優先順位の可視化**: どのテストが最重要かを明確化
3. **時間管理の支援**: 各テストの所要時間見積もりでスケジュール管理
4. **成功基準の明確化**: 最小成功基準（7テスト）と理想基準（18テスト）の区別
5. **進捗の可視化**: チェックリストで進捗を一目で確認

---

**作成者**: Claude Code
**最終更新**: 2025-11-06 12:30
**ステータス**: 実施準備完了
