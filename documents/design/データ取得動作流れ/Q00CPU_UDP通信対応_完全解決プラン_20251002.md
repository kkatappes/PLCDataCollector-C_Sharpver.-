# Q00CPU UDPé€šä¿¡å¯¾å¿œ å®Œå…¨è§£æ±ºãƒ—ãƒ©ãƒ³

## ğŸ“… ä½œæˆæ—¥
2025-10-02

## ğŸ¯ ç›®çš„
Q00CPUã¨ã®å®‰å®šã—ãŸSLMPé€šä¿¡ç¢ºç«‹ã¨6ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼æ­£å¸¸å®Ÿè¡Œ

## ğŸ“Š å•é¡Œåˆ†æçµæœ

### ğŸ” ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ç¢ºèªçµæœ
```bash
# åŸºæœ¬æ¥ç¶šç¢ºèª
ping 172.30.40.15
# çµæœ: æˆåŠŸ (0-1ms, TTL=63) âœ…

# TCPæ¥ç¶šç¢ºèª
powershell -Command "Test-NetConnection -ComputerName 172.30.40.15 -Port 8192"
# çµæœ: TcpTestSucceeded : False âŒ

powershell -Command "Test-NetConnection -ComputerName 172.30.40.15 -Port 5007"
# çµæœ: TcpTestSucceeded : False âŒ

powershell -Command "Test-NetConnection -ComputerName 172.30.40.15 -Port 5006"
# çµæœ: TcpTestSucceeded : False âŒ

# UDPæ¥ç¶šç¢ºèª
powershell "$udp = New-Object System.Net.Sockets.UdpClient; try { $udp.Connect('172.30.40.15', 8192); Write-Host 'UDP 8192: Connected'; $udp.Close() } catch { Write-Host 'UDP 8192: Failed' }"
# çµæœ: UDP 8192: Connected âœ…

powershell "$udp = New-Object System.Net.Sockets.UdpClient; try { $udp.Connect('172.30.40.15', 5007); Write-Host 'UDP 5007: Connected'; $udp.Close() } catch { Write-Host 'UDP 5007: Failed' }"
# çµæœ: UDP 5007: Connected âœ…
```

### ğŸ­ Q00CPUä»•æ§˜åˆ¶é™ã®ç¢ºå®š

#### é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«å¯¾å¿œçŠ¶æ³
| ãƒ—ãƒ­ãƒˆã‚³ãƒ« | ãƒãƒ¼ãƒˆ | å¯¾å¿œçŠ¶æ³ | å‚™è€ƒ |
|------------|--------|----------|------|
| TCP | 8192 | âŒ éå¯¾å¿œ | å…¨TCPãƒãƒ¼ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ |
| TCP | 5007 | âŒ éå¯¾å¿œ | æ¨™æº–SLMPãƒãƒ¼ãƒˆã‚‚ä¸å¯ |
| TCP | 5006 | âŒ éå¯¾å¿œ | ä»£æ›¿ãƒãƒ¼ãƒˆã‚‚ä¸å¯ |
| UDP | 8192 | âœ… å¯¾å¿œ | æ¥ç¶šç¢ºèªæ¸ˆã¿ |
| UDP | 5007 | âœ… å¯¾å¿œ | æ¨™æº–SLMPãƒãƒ¼ãƒˆã§æ¥ç¶šå¯èƒ½ |

#### SLMPãƒ•ãƒ¬ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—å¯¾å¿œçŠ¶æ³
| ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¿ã‚¤ãƒ— | é€šä¿¡æ–¹å¼ | çµæœ | å¯¾å¿œçŠ¶æ³ |
|----------------|----------|------|----------|
| 3E_ASCII | UDP | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | âŒ **å®Œå…¨ã«ãƒ‰ãƒ­ãƒƒãƒ—** |
| 3E_Binary | UDP | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | âŒ **å®Œå…¨ã«ãƒ‰ãƒ­ãƒƒãƒ—** |
| 4E_ASCII | UDP | 20æ–‡å­—å¿œç­” | âš ï¸ **éƒ¨åˆ†å¯¾å¿œ** |
| 4E_Binary | UDP | ã‚¨ãƒ©ãƒ¼1023 | âš ï¸ **éƒ¨åˆ†å¯¾å¿œ** |

### ğŸš¨ ç‰¹å®šã•ã‚ŒãŸå•é¡Œ

#### 1. ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­å®šå•é¡Œ
- **ç¾åœ¨ã®è¨­å®š**: TCP + 3Eãƒ•ãƒ¬ãƒ¼ãƒ  â†’ Q00CPUéå¯¾å¿œ
- **å¿…è¦ãªè¨­å®š**: UDP + 4Eãƒ•ãƒ¬ãƒ¼ãƒ  â†’ Q00CPUå¯¾å¿œ

#### 2. ãƒ‘ãƒ¼ã‚µãƒ¼å•é¡Œ
- **16é€²æ–‡å­—è§£æã‚¨ãƒ©ãƒ¼**: `Invalid hex character: D` (SlmpResponseParser.cs:345)
- **ãƒ•ãƒ¬ãƒ¼ãƒ é•·ãƒã‚§ãƒƒã‚¯**: 22æ–‡å­—æœŸå¾…ã€å®Ÿéš›20æ–‡å­—å¿œç­”

#### 3. ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ å•é¡Œ
- **ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆ**: è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰åŒæ™‚æ›¸ãè¾¼ã¿ç«¶åˆ (UnifiedLogWriter.cs:314)

## ğŸ”§ è§£æ±ºæ‰‹é †

### Phase 1: é€šä¿¡è¨­å®šã®ä¿®æ­£

#### 1-1. appsettings.json ã®ä¿®æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `C:\Users\1010821\Desktop\python\andon\andon\appsettings.json`

**ä¿®æ­£å†…å®¹**:
```json
{
  "PlcConnection": {
    "HostName": "172.30.40.15",
    "Port": 8192,                    // 8192 (Q00CPUé‹ç”¨ãƒãƒ¼ãƒˆ)
    "UseTcp": false,                 // true â†’ false (UDPä½¿ç”¨)
    "FrameVersion": "4E",            // "3E" â†’ "4E" (Q00CPUå¯¾å¿œ)
    "IsBinary": false,               // ASCII ãƒ¢ãƒ¼ãƒ‰ç¶™ç¶š
    "Timeout": 10000,                // 5000 â†’ 10000 (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·)
    "NetworkNo": 0,
    "PCNo": 255,
    "RequestDestination": 1023,
    "RequestSource": 0
  },
  // ä»–ã®è¨­å®šé …ç›®ã¯ãã®ã¾ã¾ç¶­æŒ
}
```

#### 1-2. è¨­å®šå¤‰æ›´ã®æ ¹æ‹ 
- **Port 8192**: Q00CPUé‹ç”¨ãƒãƒ¼ãƒˆã€UDPæ¥ç¶šç¢ºèªæ¸ˆã¿ï¼ˆ5007ã¯ä»£æ›¿ãƒãƒ¼ãƒˆï¼‰
- **UseTcp: false**: Q00CPUã¯TCPéå¯¾å¿œã€UDPå¿…é ˆ
- **FrameVersion: "4E"**: 3Eãƒ•ãƒ¬ãƒ¼ãƒ ã¯å®Œå…¨ãƒ‰ãƒ­ãƒƒãƒ—ã€4Eã®ã¿å¿œç­”
- **Timeoutå»¶é•·**: ReadTypeNameå‡¦ç†ã®å®‰å®šåŒ–

### Phase 2: SLMPãƒ‘ãƒ¼ã‚µãƒ¼ã®ä¿®æ­£

#### 2-1. 16é€²æ–‡å­—è§£æã®å¼·åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `C:\Users\1010821\Desktop\python\andon\andon\Serialization\SlmpResponseParser.cs`

**ä¿®æ­£å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰**: `GetHexValue` (line 345ä»˜è¿‘)

**ä¿®æ­£å‰**:
```csharp
private static byte GetHexValue(byte hexChar)
{
    return hexChar switch
    {
        >= (byte)'0' and <= (byte)'9' => hexChar - '0',
        >= (byte)'A' and <= (byte)'F' => hexChar - 'A' + 10,
        >= (byte)'a' and <= (byte)'f' => hexChar - 'a' + 10,
        _ => throw new ArgumentException($"Invalid hex character: {(char)hexChar}")
    };
}
```

**ä¿®æ­£å¾Œ**:
```csharp
private static byte GetHexValue(byte hexChar)
{
    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¿½åŠ 
    _logger?.LogTrace("16é€²æ–‡å­—è§£æ: ãƒã‚¤ãƒˆå€¤=0x{ByteValue:X2}, æ–‡å­—='{Char}'",
                     hexChar, (char)hexChar);

    return hexChar switch
    {
        >= (byte)'0' and <= (byte)'9' => (byte)(hexChar - '0'),
        >= (byte)'A' and <= (byte)'F' => (byte)(hexChar - 'A' + 10),
        >= (byte)'a' and <= (byte)'f' => (byte)(hexChar - 'a' + 10),
        _ => throw new ArgumentException($"ç„¡åŠ¹ãª16é€²æ–‡å­—: ãƒã‚¤ãƒˆå€¤=0x{hexChar:X2}, æ–‡å­—='{(char)hexChar}', ä½ç½®æƒ…å ±ãŒå¿…è¦")
    };
}
```

#### 2-2. ãƒ•ãƒ¬ãƒ¼ãƒ é•·ãƒã‚§ãƒƒã‚¯ã®ç·©å’Œ
**ä¿®æ­£å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰**: `ParseAsciiResponse` (line 148ä»˜è¿‘)

**ä¿®æ­£å‰**:
```csharp
int headerSize = 22; // å›ºå®šå€¤
if (responseFrame.Length < headerSize)
    throw new SlmpCommunicationException($"Response frame too short: {responseFrame.Length} chars, expected at least {headerSize}");
```

**ä¿®æ­£å¾Œ**:
```csharp
// Q00CPUå¯¾å¿œ: å‹•çš„ãƒ•ãƒ¬ãƒ¼ãƒ é•·è¨ˆç®—
int minHeaderSize = version == SlmpFrameVersion.Version4E ? 20 : 22;
int headerSize = Math.Max(minHeaderSize, 16); // çµ¶å¯¾æœ€å°å€¤16

if (responseFrame.Length < headerSize)
{
    if (responseFrame.Length >= minHeaderSize)
    {
        // è­¦å‘Šãƒ¬ãƒ™ãƒ«ã§ç¶™ç¶šå‡¦ç†
        _logger?.LogWarning("ãƒ•ãƒ¬ãƒ¼ãƒ é•·ãŒæœŸå¾…å€¤ã‚ˆã‚ŠçŸ­ã„: {ActualLength}æ–‡å­—, æœŸå¾…å€¤{ExpectedLength}æ–‡å­—, æœ€å°å€¤{MinLength}æ–‡å­—ã§ç¶™ç¶š",
                           responseFrame.Length, 22, minHeaderSize);
    }
    else
    {
        throw new SlmpCommunicationException($"ãƒ•ãƒ¬ãƒ¼ãƒ é•·ä¸è¶³: {responseFrame.Length}æ–‡å­—, æœ€å°å¿…è¦{minHeaderSize}æ–‡å­—");
    }
}
```

#### 2-3. ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ€ãƒ³ãƒ—æ©Ÿèƒ½è¿½åŠ 
**SlmpClient.csã«è¿½åŠ **:
```csharp
private void LogRawResponse(byte[] responseData, string context)
{
    if (_logger.IsEnabled(LogLevel.Debug))
    {
        var hexDump = Convert.ToHexString(responseData);
        var asciiDump = Encoding.ASCII.GetString(responseData.Where(b => b >= 32 && b <= 126).ToArray());

        _logger.LogDebug("SLMPç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ€ãƒ³ãƒ— [{Context}]:", context);
        _logger.LogDebug("  16é€²: {HexDump}", hexDump);
        _logger.LogDebug("  ASCII: {AsciiDump}", asciiDump);
        _logger.LogDebug("  ã‚µã‚¤ã‚º: {Size}ãƒã‚¤ãƒˆ", responseData.Length);
    }
}

// ReadTypeNameAsyncãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å‘¼ã³å‡ºã—
private async Task<string> ReadTypeNameAsync(ushort timeout, CancellationToken cancellationToken)
{
    try
    {
        var response = await SendCommandAsync(command, timeout, cancellationToken);
        LogRawResponse(response, "ReadTypeName");
        return ParseTypeName(response);
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "ReadTypeNameå®Ÿè¡Œã‚¨ãƒ©ãƒ¼");
        throw;
    }
}
```

### Phase 3: ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ä¿®æ­£

#### 3-1. ãƒ•ã‚¡ã‚¤ãƒ«æ’ä»–åˆ¶å¾¡ã®å®Ÿè£…
**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `C:\Users\1010821\Desktop\python\andon\andon\Core\UnifiedLogWriter.cs`

**ä¿®æ­£å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰**: `WriteLogEntryAsync` (line 314ä»˜è¿‘)

**è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
```csharp
private readonly SemaphoreSlim _writeSemaphore = new(1, 1);
private readonly object _disposeLock = new object();
private bool _disposed = false;
```

**ä¿®æ­£å¾Œãƒ¡ã‚½ãƒƒãƒ‰**:
```csharp
private async Task WriteLogEntryAsync(object logEntry)
{
    if (_disposed) return;

    await _writeSemaphore.WaitAsync();
    try
    {
        var json = JsonSerializer.Serialize(logEntry, _jsonOptions);

        // æ’ä»–åˆ¶å¾¡ä»˜ããƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
        using var stream = new FileStream(_logFilePath, FileMode.Append,
                                         FileAccess.Write, FileShare.ReadWrite);
        using var writer = new StreamWriter(stream, Encoding.UTF8);
        await writer.WriteLineAsync(json);
        await writer.FlushAsync();
    }
    catch (IOException ex)
    {
        _logger?.LogWarning("ãƒ­ã‚°æ›¸ãè¾¼ã¿ä¸€æ™‚çš„å¤±æ•—: {Error}", ex.Message);
        // ãƒªãƒˆãƒ©ã‚¤ã¯è¡Œã‚ãšã€ãƒ‡ãƒ¼ã‚¿æ¬ æã‚’è¨±å®¹
    }
    finally
    {
        _writeSemaphore.Release();
    }
}
```

#### 3-2. Disposeå®Ÿè£…
```csharp
public void Dispose()
{
    lock (_disposeLock)
    {
        if (!_disposed)
        {
            _writeSemaphore?.Dispose();
            _disposed = true;
        }
    }
}
```

### Phase 4: IntelligentMonitoringSystem ã®å¼·åŒ–

#### 4-1. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®æ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `C:\Users\1010821\Desktop\python\andon\andon\Core\IntelligentMonitoringSystem.cs`

**ä¿®æ­£å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰**: `Step2_ConnectAndGetDeviceInfoAsync`

```csharp
private async Task<(bool connected, string typeName, string typeCode)> Step2_ConnectAndGetDeviceInfoAsync(
    PlcConnectionInfo connectionInfo, CancellationToken cancellationToken)
{
    try
    {
        // UDP + 4Eãƒ•ãƒ¬ãƒ¼ãƒ è¨­å®šã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
        var client = new SlmpClient(connectionInfo.HostName, connectionInfo.Port,
                                   useTcp: false, // UDPå¼·åˆ¶
                                   frameVersion: SlmpFrameVersion.Version4E, // 4Eå¼·åˆ¶
                                   isBinary: false); // ASCII

        await client.ConnectAsync(cancellationToken);

        try
        {
            var typeName = await client.ReadTypeNameAsync(5000, cancellationToken);
            _logger.LogInformation("Step 2æˆåŠŸ: æ©Ÿå™¨å‹åå–å¾— '{TypeName}'", typeName);
            return (true, typeName, ExtractTypeCode(typeName));
        }
        catch (SlmpCommunicationException ex) when (ex.Message.Contains("Invalid hex character"))
        {
            _logger.LogWarning("ReadTypeNameè§£æã‚¨ãƒ©ãƒ¼ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†å®Ÿè¡Œ: {Error}", ex.Message);

            // Q00CPUæ¨å®šã§ç¶™ç¶š
            var fallbackTypeCode = "Q00CPU";
            _logger.LogInformation("Step 2ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ: TypeCode={TypeCode} (æ¨å®šå€¤)", fallbackTypeCode);
            return (true, "Unknown", fallbackTypeCode);
        }
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Step 2å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {Error}", ex.Message);
        return (false, "Unknown", "Unknown");
    }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ‰‹é †

### ãƒ†ã‚¹ãƒˆæº–å‚™

#### 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
```bash
# ç¾åœ¨ã®è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp andon/appsettings.json andon/appsettings.json.backup.20251002

# ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp andon/Serialization/SlmpResponseParser.cs andon/Serialization/SlmpResponseParser.cs.backup.20251002
cp andon/Core/UnifiedLogWriter.cs andon/Core/UnifiedLogWriter.cs.backup.20251002
cp andon/Core/IntelligentMonitoringSystem.cs andon/Core/IntelligentMonitoringSystem.cs.backup.20251002
```

#### 2. æ®µéšçš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**Stage 1: è¨­å®šå¤‰æ›´ã®ã¿ãƒ†ã‚¹ãƒˆ**
```bash
cd C:\Users\1010821\Desktop\python\andon

# appsettings.jsonã®ã¿ä¿®æ­£ã—ã¦ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet run

# æœŸå¾…ã•ã‚Œã‚‹çµæœ
# - UDPæ¥ç¶šæˆåŠŸ
# - 4Eãƒ•ãƒ¬ãƒ¼ãƒ é€šä¿¡æˆåŠŸ
# - ReadTypeNameéƒ¨åˆ†çš„æˆåŠŸã¾ãŸã¯è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±
```

**Stage 2: ãƒ‘ãƒ¼ã‚µãƒ¼ä¿®æ­£è¿½åŠ ãƒ†ã‚¹ãƒˆ**
```bash
# SlmpResponseParser.csä¿®æ­£å¾Œ
dotnet build
dotnet run

# æœŸå¾…ã•ã‚Œã‚‹çµæœ
# - 16é€²æ–‡å­—è§£æã‚¨ãƒ©ãƒ¼ã®è©³ç´°æƒ…å ±å‡ºåŠ›
# - ãƒ•ãƒ¬ãƒ¼ãƒ é•·ã‚¨ãƒ©ãƒ¼ã®è­¦å‘Šãƒ¬ãƒ™ãƒ«å‡¦ç†
# - Step 2ã§ã®ReadTypeNameæˆåŠŸã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
```

**Stage 3: ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ä¿®æ­£ãƒ†ã‚¹ãƒˆ**
```bash
# UnifiedLogWriter.csä¿®æ­£å¾Œ
dotnet run

# æœŸå¾…ã•ã‚Œã‚‹çµæœ
# - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆã‚¨ãƒ©ãƒ¼ãªã—
# - logs/intelligent_monitoring_log.logæ­£å¸¸ç”Ÿæˆ
# - Step 4ã§ã®ãƒ‡ãƒã‚¤ã‚¹ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†
```

**Stage 4: çµ±åˆãƒ†ã‚¹ãƒˆ**
```bash
# å…¨ä¿®æ­£å®Œäº†å¾Œã®æœ€çµ‚ãƒ†ã‚¹ãƒˆ
dotnet run

# æœŸå¾…ã•ã‚Œã‚‹çµæœï¼ˆæˆåŠŸç¢ºèªé …ç›®ï¼‰
# - âœ… Step 1: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ
# - âœ… Step 2: ReadTypeNameæˆåŠŸã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ
# - âœ… Step 3: ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰æŠ½å‡ºæˆåŠŸï¼ˆQ00CPUå¯¾å¿œï¼‰
# - âœ… Step 4: 45,056ãƒ‡ãƒã‚¤ã‚¹ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†
# - âœ… Step 5: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆ0å€‹ä»¥ä¸Šï¼‰
# - âœ… Step 6: ç¶™ç¶šç›£è¦–å®Ÿè¡Œï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒã‚¤ã‚¹ãŒã‚ã‚‹å ´åˆï¼‰
# - âœ… ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆãªã—
# - âœ… çµ±åˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸å‹•ä½œ
```

### æˆåŠŸç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### åŸºæœ¬é€šä¿¡ç¢ºèª
- [ ] PLCæ¥ç¶šç¢ºç«‹ï¼ˆUDP 8192ï¼‰
- [ ] 4Eãƒ•ãƒ¬ãƒ¼ãƒ é€šä¿¡æˆåŠŸ
- [ ] ReadTypeNameæˆåŠŸã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ

#### 6ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼ç¢ºèª
- [ ] Step 1: è¨­å®šèª­ã¿è¾¼ã¿æˆåŠŸ
- [ ] Step 2: æ©Ÿå™¨æƒ…å ±å–å¾—æˆåŠŸ
- [ ] Step 3: ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰æŠ½å‡ºæˆåŠŸ
- [ ] Step 4: ãƒ‡ãƒã‚¤ã‚¹ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†ï¼ˆ45,056å€‹ï¼‰
- [ ] Step 5: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒã‚¤ã‚¹æŠ½å‡ºå®Œäº†
- [ ] Step 6: ç¶™ç¶šç›£è¦–å®Ÿè¡Œ

#### ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª
- [ ] logs/intelligent_monitoring_log.logç”Ÿæˆ
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆã‚¨ãƒ©ãƒ¼ãªã—
- [ ] å…¨7ç¨®é¡ã®ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã‚¿ã‚¤ãƒ—å‡ºåŠ›
- [ ] ç”ŸSLMPãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ€ãƒ³ãƒ—å‡ºåŠ›ï¼ˆDebugä»¥ä¸Šï¼‰

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª
- [ ] 16é€²æ–‡å­—è§£æã‚¨ãƒ©ãƒ¼ã®è©³ç´°è¨ºæ–­
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ é•·ä¸è¶³ã®è­¦å‘Šãƒ¬ãƒ™ãƒ«å‡¦ç†
- [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®æ­£å¸¸å‹•ä½œ

## ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

### å•é¡Œç™ºç”Ÿæ™‚ã®å¾©æ—§æ–¹æ³•

```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰è¨­å®šå¾©å…ƒ
cp andon/appsettings.json.backup.20251002 andon/appsettings.json

# 2. ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å¾©å…ƒ
cp andon/Serialization/SlmpResponseParser.cs.backup.20251002 andon/Serialization/SlmpResponseParser.cs
cp andon/Core/UnifiedLogWriter.cs.backup.20251002 andon/Core/UnifiedLogWriter.cs
cp andon/Core/IntelligentMonitoringSystem.cs.backup.20251002 andon/Core/IntelligentMonitoringSystem.cs

# 3. å†ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œ
dotnet clean
dotnet build
dotnet run

# 4. å…ƒã®çŠ¶æ…‹ã§ã®å‹•ä½œç¢ºèª
# ï¼ˆå…ƒã®ã‚¨ãƒ©ãƒ¼ãŒå†ç¾ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
```

## ğŸ“‹ é•·æœŸçš„ãªæ”¹å–„è¨ˆç”»

### Phase 5: è¿½åŠ çš„ãªå¼·åŒ–é …ç›®

#### 5-1. Q00CPUå°‚ç”¨è¨­å®šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
```json
{
  "PlcProfiles": {
    "Q00CPU": {
      "SupportedProtocols": ["UDP"],
      "SupportedFrames": ["4E"],
      "DefaultPort": 8192,
      "MaxDeviceScanSize": 45056,
      "SpecialHandling": {
        "ReadTypeNameFallback": true,
        "FrameLengthTolerance": 2,
        "HexParsingRobust": true
      }
    }
  }
}
```

#### 5-2. è‡ªå‹•PLCå‹å¼æ¤œå‡ºæ©Ÿèƒ½
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚­ãƒ£ãƒ³ã«ã‚ˆã‚‹PLCç™ºè¦‹
- é€šä¿¡ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å¯¾å¿œãƒ—ãƒ­ãƒˆã‚³ãƒ«è‡ªå‹•åˆ¤å®š
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ

#### 5-3. çµ±åˆè¨ºæ–­ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡çŠ¶æ³è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼çµ±è¨ˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- è¨­å®šæœ€é©åŒ–æ¨å¥¨æ©Ÿèƒ½

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### å‚ç…§ä»•æ§˜æ›¸
- **SLMPãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«**: `pdf2img/sh080931q.pdf`
  - ãƒšãƒ¼ã‚¸33: ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§
  - ãƒšãƒ¼ã‚¸136: Read Type Nameè©³ç´°
  - ãƒšãƒ¼ã‚¸10,229,230: ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ 

### æ—¢å­˜è¨­è¨ˆæ›¸
- `SLMP_ASCIIãƒ•ãƒ¬ãƒ¼ãƒ è§£æã‚¨ãƒ©ãƒ¼è§£æ±ºæ‰‹é †.md`: åŸºç¤åˆ†æ
- `6ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼å®Ÿè£…è¨ˆç”».md`: ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ
- `è¨­è¨ˆæ›¸æº–æ‹ ãƒ­ã‚°å‡ºåŠ›_Step4ç”Ÿãƒ‡ãƒ¼ã‚¿è¨˜éŒ²_å®Œå…¨å®Ÿè£…è¨ˆç”»_20241001.md`: ãƒ­ã‚°è¨­è¨ˆ

### æ¤œè¨¼çµæœãƒ•ã‚¡ã‚¤ãƒ«
- `logs/actvconnect.txt`: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç¢ºèªçµæœ
- `logs/æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ.txt`: è¿½åŠ ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆçµæœ

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹æœ€çµ‚çµæœ

### ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œçŠ¶æ³
```
===================================================
    SLMP ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  v2.0
    å…¨39ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œãƒ»å®Œå…¨æ¢ç´¢ã‚·ã‚¹ãƒ†ãƒ 
===================================================

âœ… 6ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œé–‹å§‹
âœ… Step 1å®Œäº†: PLCæ¥ç¶šå…ˆ='è£½é€ ãƒ©ã‚¤ãƒ³PLC' (172.30.40.15:8192)
âœ… Step 2å®Œäº†: æ©Ÿå™¨å‹å='Q00CPU', TypeCode=Q00CPU
âœ… Step 3å®Œäº†: ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰æŠ½å‡ºï¼ˆãƒ“ãƒƒãƒˆ6ç¨®é¡, ãƒ¯ãƒ¼ãƒ‰2ç¨®é¡ï¼‰
âœ… Step 4å®Œäº†: ãƒ‡ãƒã‚¤ã‚¹ã‚¹ã‚­ãƒ£ãƒ³ 45,056å€‹å®Œäº†, ã‚¢ã‚¯ãƒ†ã‚£ãƒ– XXå€‹æ¤œå‡º
âœ… Step 5å®Œäº†: éã‚¼ãƒ­ãƒ‡ãƒ¼ã‚¿ãƒ‡ãƒã‚¤ã‚¹ XXå€‹æŠ½å‡º
âœ… Step 6é–‹å§‹: ç¶™ç¶šç›£è¦–å®Ÿè¡Œä¸­

ğŸ“Š çµ±è¨ˆæƒ…å ±:
- å®Ÿè¡Œæ™‚é–“: X.Xç§’
- ã‚¹ã‚­ãƒ£ãƒ³æˆåŠŸç‡: 100%
- ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒª: XXXä»¶ç”Ÿæˆ
- ã‚¨ãƒ©ãƒ¼: 0ä»¶

âœ… å…¨ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸å‹•ä½œä¸­
===================================================
```

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ä¾‹
```json
{
  "EntryType": "CYCLE_COMMUNICATION",
  "SessionId": "session_20251002_XXXXXX",
  "DeviceCode": "M",
  "StartAddress": 0,
  "DataLength": 1,
  "RawSlmpFrame": "35303030303046464646303345303030303030304D2A2A2A2A30303031",
  "CommunicationResult": "Success",
  "ResponseData": "0001",
  "ElapsedMs": 15
}
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å®‰å…¨æ€§è€ƒæ…®äº‹é …

### PLCé€šä¿¡æ™‚ã®æ³¨æ„ç‚¹
- **é‹ç”¨ä¸­ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿**: èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚å½±éŸ¿æœ€å°
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è² è·**: ãƒ‡ãƒã‚¤ã‚¹ã‚¹ã‚­ãƒ£ãƒ³æ™‚ã®é€šä¿¡é‡è€ƒæ…®
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: PLCåœæ­¢ã‚’å¼•ãèµ·ã“ã•ãªã„ç¶™ç¶šãƒ¢ãƒ¼ãƒ‰

### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«**: æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™å¿…è¦
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: IPã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ä¿è­·

---

## ğŸ“ å±¥æ­´
- **2025-10-02**: åˆç‰ˆä½œæˆ
  - Q00CPU UDPé€šä¿¡å¯¾å¿œã®å®Œå…¨è§£æ±ºãƒ—ãƒ©ãƒ³ç­–å®š
  - TCP/UDPæ¥ç¶šãƒ†ã‚¹ãƒˆçµæœã®è©³ç´°åˆ†æ
  - 3Eãƒ•ãƒ¬ãƒ¼ãƒ å®Œå…¨ãƒ‰ãƒ­ãƒƒãƒ—ã®ç¢ºå®š
  - æ®µéšçš„å®Ÿè£…æ‰‹é †ã®è©³ç´°åŒ–
  - å¾Œæ—¥å†ç¾å¯èƒ½ãªå®Œå…¨æ‰‹é †ã®è¨˜éŒ²

## ğŸ‘¤ ä½œæˆè€…
Claude Code ã«ã‚ˆã‚‹åŒ…æ‹¬çš„åˆ†æãƒ»è§£æ±ºãƒ—ãƒ©ãƒ³ç­–å®š