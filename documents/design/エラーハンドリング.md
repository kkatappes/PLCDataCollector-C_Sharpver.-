# エラーハンドリング

◆エラー分類定義
    ・設定エラー (ConfigurationError)
    ・通信エラー (CommunicationError)
    ・データエラー (DataProcessingError)
    ・リソースエラー (ResourceError)
    ・システムエラー (SystemError)

**全てのエラーで何の処理が失敗したかのメッセージを出力**

◆重要度の分類
    ・情報（Info）: 記録のみ
    ・警告（Warning）: 注意が必要
    ・エラー（Error）: 処理失敗
    ・致命的（Fatal）: システム停止

◆リトライ方針
- エラー分類
    ・設定エラー (ConfigurationError)
    →リトライしない
    ・通信エラー (CommunicationError)
    →ステップ毎にリトライする/しないを決定
    ・データエラー (DataProcessingError)
    →リトライしない
    ・リソースエラー (ResourceError)
    →リトライしない
    ・システムエラー (SystemError)
    →ステップ毎にリトライする/しないを決定

- 方針に従った各ステップのリトライ設定
    Step1 リトライしない
    Step2 リトライしない
    Step3 最大3回リトライ
    Step4 リトライしない(1秒ごとに送受信するので、次のタイミングを待つ)
    Step5 リトライしない
    Step6 リトライしない
    Step7 最大2回リトライ (ファイル書き込み失敗時)

- 各ステップでの失敗時の処理方針
    Step1
    ・設定ファイルが存在しない
    →終了
    ・JSONの書式が間違っている
    →終了
    ・必須項目が未設定
    →終了

    Step2
    ・不正なデバイス範囲指定
    →終了
    ・フレーム形式の設定ミス
    →終了

    Step3
    ・IPアドレスに到達できない
    →終了
    ・ポートが閉じている
    →終了
    ・ネットワーク障害
    →終了

    Step4
    ・送信したフレームが不正でPLCが応答しない
    →終了
    ・PLCからの応答が途中で切れる（パケット欠損）
    →継続
    ・PLCの処理能力を超えるリクエスト（負荷過多）
    →終了
    ・PLCが一時的にビジー状態
    →終了
    ・受信データのサイズが予想と異なる
    →継続
    ・受信タイムアウト（PLCからの応答がない）
    →継続
    ・ネットワーク遅延による部分受信
    →継続
    ・PLCの電源が落ちる/リセットされる
    →継続

    Step5
    ・PLC側が既に切断済みで応答がない
    →継続
    ・切断処理中にネットワーク障害
    →継続
    ・ソケットリソースの解放失敗
    →継続
    ・切断完了前にアプリケーション終了
    →継続
    ・複数接続がある場合の切断順序ミス
    →継続

    Step6
    ・受信した16進数データが不正フォーマット
    →継続
    ・データ長が期待値と異なる
    →継続
    ・PLCエラーコードが含まれている
    →継続
    ・DWordデータの結合処理でバイト順序ミス
    →継続
    ・文字コード変換エラー
    →継続
    ・データ内に予期しない制御文字
    →継続
    ・ヘッダー情報とデータ部の整合性不一致
    →継続
    ・メモリ不足によるデータ処理失敗
    →継続

    Step7
    ・出力先ディスクの容量不足
    →終了
    ・ファイル書き込み権限がない
    →終了
    ・ファイルが他のプロセスに使用中（ロック）
    →継続
    ・出力形式変換でのデータ欠損
    →継続
    ・ログローテーション処理の失敗
    →継続
    ・ファイル出力中にアプリケーション強制終了
    →終了
    ・ネットワークドライブへの出力で通信エラー
    →終了
    ・大量データ出力時のメモリ不足
    →終了

