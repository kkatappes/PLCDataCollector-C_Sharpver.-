# ハードコード状況確認

**調査日**: 2025-11-27
**対象**: andonプロジェクト（テストコード除外）
**目的**: 本番コード内でハードコードされている設定項目の洗い出し

---

## 調査結果サマリー

本番コード内で設定値がハードコードされている箇所を調査した結果、以下のカテゴリに分類される設定項目が確認されました：

- **外部化推奨（高）**: 1項目（セマフォ初期値）
- **外部化推奨（中）**: 4項目（タイムアウト、疎通確認フレーム等）
- **外部化不要（低）**: 設定ファイルで既に上書き可能なデフォルト値
- **外部化不要（極低）**: プロトコル仕様固定値、定数類

---

## 1. タイムアウト関連

### 1.1 ConfigurationWatcher.cs:21
```csharp
private readonly TimeSpan _debounceInterval = TimeSpan.FromMilliseconds(100);
```

- **項目**: ファイル変更監視のデバウンス間隔
- **現在値**: 100ミリ秒
- **用途**: FileSystemWatcherの重複イベント抑制
- **外部化推奨度**: **低**
- **理由**: 通常変更不要な内部制御値

---

### 1.2 GracefulShutdownHandler.cs:36
```csharp
timeout = TimeSpan.FromSeconds(30);
```

- **項目**: 適切な終了処理のデフォルトタイムアウト
- **現在値**: 30秒
- **用途**: アプリケーション終了時の待機時間
- **外部化推奨度**: **中**
- **理由**: 環境によって適切な値が異なる可能性あり
- **影響範囲**: `ExecuteGracefulShutdown()` メソッド

---

### 1.3 ResourceSemaphoreManager.cs:28
```csharp
var actualTimeout = timeout ?? TimeSpan.FromSeconds(30);
```

- **項目**: セマフォ取得時のデフォルトタイムアウト
- **現在値**: 30秒
- **用途**: 排他制御のロック取得待機時間
- **外部化推奨度**: **中**
- **理由**: 高負荷環境では調整が必要になる可能性
- **影響範囲**: `ExecuteWithSemaphoreAsync()` メソッド

---

## 2. セマフォ（排他制御）初期値

### 2.1 ResourceSemaphoreManager.cs:17-19
```csharp
LogFileSemaphore = new SemaphoreSlim(1, 1);      // ログファイル
ConfigFileSemaphore = new SemaphoreSlim(3, 3);   // 設定ファイル
OutputFileSemaphore = new SemaphoreSlim(2, 2);   // 出力ファイル
```

- **項目**: 各リソースの同時アクセス数上限
- **現在値**:
  - ログファイル: 1（同時アクセス禁止）
  - 設定ファイル: 3（最大3スレッド同時読み込み可）
  - 出力ファイル: 2（最大2スレッド同時書き込み可）
- **用途**: 並列処理時のリソース競合制御
- **外部化推奨度**: **高**
- **理由**:
  - 並列PLC数やシステムリソースに応じた調整が必要
  - パフォーマンスチューニングの重要パラメータ
  - 運用環境によって最適値が大きく異なる
- **推奨対応**: `SystemResourcesConfig` への追加

---

## 3. 接続設定デフォルト値

### 3.1 PlcConnectionConfig.cs
```csharp
IPAddress = "127.0.0.1";           // Line 9
Port = 8192;                        // Line 10
ConnectionMethod = "UDP";           // Line 11
FrameVersion = "3E";                // Line 12
Timeout = 8000;                     // Line 13
PlcId = "PLC_001";                  // Line 20
PlcName = "ライン1_設備A";          // Line 25
Priority = 5;                       // Line 30
```

- **項目**: PLC接続のデフォルト設定
- **用途**: 設定ファイル未指定時のフォールバック値
- **外部化推奨度**: **低**
- **理由**: これらは設定ファイル（JSON/Excel）で上書きされる前提のデフォルト値
- **現状**: 既に外部設定可能

---

## 4. タイムアウト設定デフォルト値

### 4.1 TimeoutConfig.cs
```csharp
ConnectTimeoutMs = 3000;    // Line 11: 接続タイムアウト（既定値: 3000ms = 3秒）
SendTimeoutMs = 500;        // Line 16: 送信タイムアウト（既定値: 500ms = 0.5秒）
ReceiveTimeoutMs = 500;     // Line 21: 受信タイムアウト（既定値: 500ms = 0.5秒）
SendIntervalMs = 100;       // Line 26: フレーム送信間隔（既定値: 100ms）
```

**⚠️ 重要**: これらの既定値は厳守してください。意図しない既定値が混在するとデバッグが困難になります。

- **項目**: 各種タイムアウトのデフォルト値
- **外部化推奨度**: **低**
- **理由**: 設定ファイルで既に上書き可能
- **現状**: appsettings.json で設定可能

---

## 5. データ処理設定

### 5.1 DataProcessingConfig.cs:11
```csharp
MonitoringIntervalMs = 5000; // デフォルト5秒
```

- **項目**: データ監視間隔
- **外部化推奨度**: **低**
- **理由**: 設定ファイルで既に上書き可能

### 5.2 DependencyInjectionConfigurator.cs:27
```csharp
options.MonitoringIntervalMs = 5000; // デフォルト5秒
```

- **項目**: DI設定時の監視間隔デフォルト値（上記と重複）
- **外部化推奨度**: **低**
- **備考**: DataProcessingConfig と同じ値の重複定義

---

## 6. 並列処理設定

### 6.1 ParallelProcessingConfig.cs
```csharp
MaxDegreeOfParallelism = 0;     // Line 16: 最大並列度（0=制限なし）
OverallTimeoutMs = 30000;       // Line 21: 全PLC処理完了タイムアウト
```

- **項目**: 並列処理の制御パラメータ
- **外部化推奨度**: **低**
- **理由**: 設定ファイルで既に上書き可能

---

## 7. PLC通信関連固定値

### 7.1 UDP疎通確認フレーム
**PlcCommunicationManager.cs:213**
```csharp
const string verificationFrame = "54001234000000010401006400000090E8030000";
```

- **項目**: UDP疎通確認用検証フレーム
- **内容**: M000-M999の読み込みフレーム（4Eフレーム）
- **用途**: UDP接続確立後の疎通確認テスト
- **外部化推奨度**: **中**
- **理由**:
  - 疎通確認に使用するデバイスアドレス範囲は環境依存
  - 一部のPLCでMデバイスが使用できない場合がある
  - 読み込み点数の調整が必要な場合がある
- **推奨対応**: `ConnectionConfig` への追加
  - `VerificationDeviceType`: "M", "D", "W" など
  - `VerificationStartAddress`: 0
  - `VerificationPointCount`: 100

---

### 7.2 SLMPフレームパース用定数
**PlcCommunicationManager.cs:1604-1607（ASCII 3E）**
```csharp
const int HeaderSize = 20;
const string ExpectedSubHeader = "D0";
const int DataLengthOffset = 12;
const int EndCodeOffset = 16;
```

**PlcCommunicationManager.cs:1647-1650（ASCII 4E）**
```csharp
const int HeaderSize = 30;
const string ExpectedSubHeader = "D4";
const int DataLengthOffset = 22;
const int EndCodeOffset = 26;
```

- **項目**: SLMPプロトコル仕様固定値
- **外部化推奨度**: **極低**
- **理由**: SLMPプロトコル仕様で規定された固定値
- **備考**: 変更不要（プロトコル仕様変更時のみ）

---

## 8. データ出力関連

### 8.1 DataOutputManager.cs
```csharp
private const int BitsPerWord = 16;        // Line 20: 1ワード = 16ビット
private const int DefaultDigits = 1;       // Line 21: デフォルト桁数
const string plcModel = "Unknown";         // Line 49: PLCモデル不明時
```

- **項目**: データ処理用定数
- **外部化推奨度**:
  - `BitsPerWord`: **極低**（PLC仕様固定値）
  - `DefaultDigits`: **低**（設定ファイルで指定可能）
  - `plcModel`: **低**（フォールバック値）

---

## 9. ファイル監視設定

### 9.1 ConfigurationWatcher.cs:47
```csharp
Filter = "*.json"
```

- **項目**: 監視対象ファイル拡張子
- **現在値**: JSONファイルのみ
- **外部化推奨度**: **中**
- **理由**:
  - Excelファイル（*.xlsx）の変更監視が必要な場合がある
  - 将来的に他の設定形式（YAML等）をサポートする可能性
- **推奨対応**:
  - `ConfigurationWatcherSettings` の追加
  - `WatchFileExtensions`: ["*.json", "*.xlsx"]

---

## 10. その他の定数（外部化不要）

以下は**外部化不要**な定数類です：

### 10.1 SlmpConstants.cs
- `Frame3EHeaderSize = 15`（仕様固定値）
- `Frame4EHeaderSize = 13`（仕様固定値）
- ~~`ReceiveTimeoutMs = 500`~~（削除: TimeoutConfig.ReceiveTimeoutMsを使用）

### 10.2 ErrorConstants.cs
- エラー種別定数（"Validation", "Timeout", "Network" 等）

### 10.3 ErrorMessages.cs
- エラーメッセージテンプレート（日本語文字列）

### 10.4 ExitCodeManager.cs
- 終了コード定義（0=Success, 1=ConfigError 等）

### 10.5 DeviceConstants.cs
- デバイスコード定義（0x9C=M, 0xA8=D 等）

### 10.6 SlmpFrameBuilder.cs
- `MAX_FRAME_LENGTH = 8194`（SLMP仕様）

---

## 外部化推奨度別まとめ

### 【高】外部化を強く推奨

| 項目 | ファイル | 行 | 現在値 | 推奨設定先 |
|------|----------|-----|--------|-----------|
| LogFileSemaphore | ResourceSemaphoreManager.cs | 17 | 1 | SystemResourcesConfig |
| ConfigFileSemaphore | ResourceSemaphoreManager.cs | 18 | 3 | SystemResourcesConfig |
| OutputFileSemaphore | ResourceSemaphoreManager.cs | 19 | 2 | SystemResourcesConfig |

**対応方針**:
```json
// appsettings.json への追加例
{
  "SystemResources": {
    "SemaphoreSettings": {
      "LogFileMaxConcurrency": 1,
      "ConfigFileMaxConcurrency": 3,
      "OutputFileMaxConcurrency": 2
    }
  }
}
```

---

### 【中】状況に応じて外部化検討

| 項目 | ファイル | 行 | 現在値 | 備考 |
|------|----------|-----|--------|------|
| GracefulShutdownTimeout | GracefulShutdownHandler.cs | 36 | 30秒 | 環境依存 |
| SemaphoreDefaultTimeout | ResourceSemaphoreManager.cs | 28 | 30秒 | 高負荷時調整 |
| UDP疎通確認フレーム | PlcCommunicationManager.cs | 213 | M000-M999 | 環境依存 |
| ファイル監視フィルタ | ConfigurationWatcher.cs | 47 | *.json | 拡張性 |

---

### 【低】外部化不要（設定ファイルで既に上書き可能）

以下は既に設定ファイルで上書き可能なため、現状のまま維持：

- **PlcConnectionConfig**: IPAddress, Port, ConnectionMethod, FrameVersion 等
- **TimeoutConfig**: ConnectTimeoutMs, SendTimeoutMs, ReceiveTimeoutMs 等
- **DataProcessingConfig**: MonitoringIntervalMs
- **ParallelProcessingConfig**: MaxDegreeOfParallelism, OverallTimeoutMs

---

### 【極低】外部化不要（プロトコル仕様/定数）

以下は仕様固定値またはプログラム定数のため、外部化不要：

- SLMP仕様定数（HeaderSize, DataLengthOffset 等）
- エラーコード、デバイスコード定義
- ビット数定義（BitsPerWord = 16）
- フレーム最大長（MAX_FRAME_LENGTH = 8194）

---

## 推奨アクション

### 優先度1（必須）
1. **セマフォ初期値の外部化**
   - `SystemResourcesConfig` に `SemaphoreSettings` セクション追加
   - `ResourceSemaphoreManager` をコンストラクタインジェクションで設定受け取り

### 優先度2（推奨）
2. **タイムアウト値の統一管理**
   - `GracefulShutdownTimeout` を `SystemResourcesConfig` に追加
   - `SemaphoreDefaultTimeout` を `SystemResourcesConfig` に追加

3. **UDP疎通確認フレームの設定化**
   - `ConnectionConfig` に疎通確認用設定追加

### 優先度3（検討）
4. **ファイル監視フィルタの拡張**
   - 複数拡張子対応（JSON + Excel）

---

## 重複定義の詳細分析

### ✅ 真の重複（要対応）

#### MonitoringIntervalMs = 5000（監視間隔5秒）

**重複箇所：**

1. **DataProcessingConfig.cs:11** - プロパティのデフォルト値
```csharp
public int MonitoringIntervalMs { get; set; } = 5000; // デフォルト5秒
```

2. **DependencyInjectionConfigurator.cs:27** - DI設定時の明示的設定
```csharp
options.MonitoringIntervalMs = 5000; // デフォルト5秒
```

**問題点：**
- 同じ値が2箇所に定義されている
- 変更時に両方を更新する必要がある（保守性低下）
- どちらが優先されるか不明確

**影響範囲：**
- ExecutionOrchestrator
- TimerService
- ApplicationController

**推奨対応：**
1. **DependencyInjectionConfigurator.cs:27の明示的設定を削除**
2. DataProcessingConfig.csのデフォルト値に一本化
3. または、appsettings.jsonからの読み込みに統一

**対応優先度：** 中（保守性向上のため早期対応推奨）

---

### ⚠️ 見かけ上の重複（対応不要）

#### TimeSpan.FromSeconds(30)（30秒タイムアウト）

**類似箇所：**

1. **GracefulShutdownHandler.cs:36** - シャットダウンタイムアウト
```csharp
if (timeout == default)
{
    timeout = TimeSpan.FromSeconds(30);  // アプリケーション終了待機時間
}
```

2. **ResourceSemaphoreManager.cs:28** - セマフォ取得タイムアウト
```csharp
var actualTimeout = timeout ?? TimeSpan.FromSeconds(30);  // ロック取得待機時間
```

**判断：これは重複ではない**

**理由：**
- **用途が異なる**：
  - GracefulShutdownHandler: アプリケーション全体の終了処理待機時間
  - ResourceSemaphoreManager: ファイルアクセス用セマフォのロック取得待機時間
- **独立して調整すべき**：
  - シャットダウン時間: PLC切断処理、リソース解放を含む全体の処理時間
  - セマフォ待機時間: 単一ファイルアクセスの待機時間
- **値が偶然一致しているだけ**で、同期させる必要はない

**対応：** 不要（それぞれ独立した設定として維持）

---

## 重複定義まとめ

| 項目 | 箇所1 | 箇所2 | 判定 | 推奨対応 |
|------|-------|-------|------|----------|
| MonitoringIntervalMs = 5000 | DataProcessingConfig.cs:11 | DependencyInjectionConfigurator.cs:27 | **真の重複** | DI側を削除 |
| TimeSpan.FromSeconds(30) | GracefulShutdownHandler.cs:36 | ResourceSemaphoreManager.cs:28 | **見かけ上の重複** | 対応不要（独立管理） |

---

## 備考

### 重複定義の解消方針
- `MonitoringIntervalMs` が `DataProcessingConfig` と `DependencyInjectionConfigurator` で重複定義
- **推奨対応**:
  1. `DependencyInjectionConfigurator.cs:27` の明示的設定を削除
  2. 設定ファイル（appsettings.json）からの読み込みに統一
  3. フォールバック値は `DataProcessingConfig.cs` のプロパティ初期化子に一本化

### デフォルト値の設計方針
現在のコードは「設定ファイル未指定時のフォールバック値」として適切に機能しているため、多くのデフォルト値は現状維持で問題なし。

### タイムアウト値の独立性
同じ値（30秒）を持つタイムアウトが複数あるが、用途が異なるため個別に管理すべき。将来的に外部化する場合も、別々の設定項目として扱うこと。

---

**調査完了**: 2025-11-27

---

## 付録: 設定ファイル読み込み時のハードコード対応方針

### A.1 現状のハードコード箇所

現在のコード内で以下の値がハードコードされている可能性があります:

| 項目 | ハードコード値例 | 対応方針 |
|-----|---------------|---------|
| **IPAddress** | "127.0.0.1" | 既定値なし。ExcelファイルB8セルから取得された値のみ使用（必須項目） |
| **Port** | 8192 | 既定値なし。ExcelファイルB9セルから取得された値のみ使用（必須項目） |
| **ConnectionMethod** | "UDP" | 既定値: "UDP"。ExcelファイルB10セルから取得された値で更新（省略可） |
| **FrameVersion** | "3E" | 既定値: "4E"。ExcelファイルB11セルから取得された値で更新（省略可） |
| **Timeout** | 8000 | 既定値: 1000 (1秒)。ExcelファイルB12セルから取得された値で更新（省略可） |
| **IsBinary** | false | 既定値: true (Binary形式)。ExcelファイルB13セルから取得された値で更新（省略可） |
| **MonitoringIntervalMs** | 5000 | 既定値: 1000 (1秒)。ExcelファイルB14セルから取得された値で更新（省略可） |
| **PlcId** | "PLC_001" | 既定値なし。設定ファイルの「IP_ポート番号」を自動生成して使用 |
| **PlcName** | "ライン1_設備A" | 既定値なし（省略可）。ExcelファイルB15セルから取得、未設定時はPlcIdを使用 |
| **Priority** | 5 | **不要** (削除対象) |

**補足説明**:

1. **IsBinary**: 現状のデフォルト値false（ASCII形式）を、true（Binary形式）に変更
   - 既定値変更により、設定ファイルで明示的に指定しない限りBinary形式を使用
   - 理由: Binary形式の方が高効率で一般的

2. **MonitoringIntervalMs** (データ取得間隔): 現状5000ms（5秒）のデフォルト値を1000ms（1秒）に変更
   - 現在は下記2箇所で重複定義されている:
     - DataProcessingConfig.cs:11 - プロパティのデフォルト値 `= 5000`
     - DependencyInjectionConfigurator.cs:27 - DI設定時の明示的設定 `= 5000`
   - 対応方針: 両方とも1000msに変更し、Excelファイルから取得された値で更新可能にする


### A.2 対応の詳細

#### A.2.1 必須項目（既定値なし）

これらの項目は必ずExcelファイルから取得する必要があります:

1. **IPAddress**
   - 既定値: なし
   - 検証: 有効なIPv4アドレス形式であること
   - 例: "192.168.1.10", "172.30.40.15"

2. **Port**
   - 既定値: なし
   - 検証: 1～65535の範囲内
   - 例: 8192, 5000

3. **PlcId**
   - 既定値: なし
   - 自動生成ルール: `{IPAddress}_{Port}`
   - 例: "192.168.1.10_8192"
   - 用途: ログ出力、データ識別子として使用

#### A.2.2 オプション項目（既定値あり）

これらの項目はExcelファイルに値がない場合、既定値を使用します:

1. **ConnectionMethod**
   - 既定値: "UDP"
   - 許可値: "TCP" または "UDP"
   - 検証: 大文字小文字を区別しない

2. **FrameVersion**
   - 既定値: "4E"
   - 許可値: "3E" または "4E"
   - 検証: 大文字小文字を区別しない

3. **Timeout**
   - 既定値: 1000 (1秒)
   - 単位: ミリ秒
   - 検証: 正の整数であること

4. **IsBinary**
   - 既定値: true (Binary形式)
   - 許可値: true または false
   - 検証: ブール値であること
   - 補足: Excelファイルに値がない場合はBinary形式を使用

5. **MonitoringIntervalMs** (データ取得間隔)
   - 既定値: 1000 (1秒)
   - 単位: ミリ秒
   - 検証: 正の整数であること
   - 補足: Excelファイルから取得された値で更新可能

#### A.2.3 オプション項目（既定値なし - Excelから取得のみ）

以下の項目はExcelファイルに値がある場合のみ使用します:

1. **PlcName** ("ライン1_設備A")
   - 既定値: なし（省略可能）
   - 用途: ログ出力、表示用の識別名として使用
   - 補足: 未設定の場合はPlcIdを使用

#### A.2.4 削除対象項目

以下の項目はシステムで使用しないため削除します:

1. **Priority** (5)
   - 理由: 優先度制御機能が未実装
   - 将来的に必要になる場合は再検討

### A.3 実装例

#### ConfigurationLoader.cs での実装イメージ

```csharp
public ConnectionConfig LoadFromExcel(string filePath)
{
    var config = new ConnectionConfig();

    // 必須項目（既定値なし）
    config.IPAddress = GetRequiredValue<string>(excel, "IPAddress");
    config.Port = GetRequiredValue<int>(excel, "Port");

    // PlcIdは自動生成
    config.PlcId = $"{config.IPAddress}_{config.Port}";

    // オプション項目（既定値あり）
    config.ConnectionMethod = GetOptionalValue(excel, "ConnectionMethod", "UDP");
    config.FrameVersion = GetOptionalValue(excel, "FrameVersion", "4E");
    config.Timeout = GetOptionalValue(excel, "Timeout", 1000);
    config.IsBinary = GetOptionalValue(excel, "IsBinary", true);
    config.MonitoringIntervalMs = GetOptionalValue(excel, "MonitoringIntervalMs", 1000);

    // オプション項目（既定値なし）
    config.PlcName = GetOptionalValue(excel, "PlcName", null) ?? config.PlcId;

    return config;
}

private T GetRequiredValue<T>(ExcelData excel, string key)
{
    var value = excel.GetValue<T>(key);
    if (value == null)
    {
        throw new ArgumentException($"必須項目 '{key}' が設定ファイルに存在しません。");
    }
    return value;
}

private T GetOptionalValue<T>(ExcelData excel, string key, T defaultValue)
{
    return excel.TryGetValue(key, out T value) ? value : defaultValue;
}
```

### A.4 検証ルール

設定値の検証ルールを以下のように定義します:

| 項目 | 検証内容 |
|-----|---------|
| **IPAddress** | - IPv4形式: xxx.xxx.xxx.xxx<br>- 各オクテット: 0～255<br>- "0.0.0.0"は不許可 |
| **Port** | - 範囲: 1～65535<br>- 一般的なPLCポート: 5000, 8192 |
| **ConnectionMethod** | - 許可値: "TCP", "UDP" (大文字小文字区別なし) |
| **FrameVersion** | - 許可値: "3E", "4E" (大文字小文字区別なし) |
| **Timeout** | - 範囲: 100～30000 (0.1秒～30秒)<br>- 推奨: 1000～10000 (1秒～10秒) |
| **IsBinary** | - 許可値: true, false<br>- 既定値: true (Binary形式) |
| **MonitoringIntervalMs** | - 範囲: 100～60000 (0.1秒～60秒)<br>- 既定値: 1000 (1秒) |
| **PlcId** | - 自動生成のため検証不要<br>- 形式: "{IPAddress}_{Port}" |
| **PlcName** | - 省略可能（未設定時はPlcIdを使用）<br>- 最大長: 100文字（推奨） |

### A.5 Excelファイルのレイアウト例

```
| 項目名              | 値                  | 備考                                    |
|--------------------|---------------------|-----------------------------------------|
| IPAddress          | 192.168.1.10        | (必須)                                   |
| Port               | 8192                | (必須)                                   |
| ConnectionMethod   | UDP                 | (省略時: UDP)                            |
| FrameVersion       | 4E                  | (省略時: 4E)                             |
| Timeout            | 5000                | (省略時: 1000) 単位: ミリ秒               |
| IsBinary           | true                | (省略時: true) Binary/ASCII形式切替       |
| MonitoringIntervalMs| 1000               | (省略時: 1000) 単位: ミリ秒 データ取得間隔 |
| PlcName            | ライン1_設備A        | (省略時: PlcIdを使用) 表示用識別名         |
```

### A.6 エラーメッセージ例

設定ファイル読み込みエラー時のメッセージ:

```csharp
// 必須項目の欠落
"必須項目 'IPAddress' が設定ファイルに存在しません。"
"必須項目 'Port' が設定ファイルに存在しません。"

// 検証エラー
"IPAddressの形式が不正です: '999.999.999.999'"
"Portの値が範囲外です: 70000 (許可範囲: 1～65535)"
"ConnectionMethodの値が不正です: 'HTTP' (許可値: TCP, UDP)"
"FrameVersionの値が不正です: '5E' (許可値: 3E, 4E)"
"Timeoutの値が範囲外です: 50 (推奨範囲: 100～30000)"
"IsBinaryの値が不正です: 'invalid' (許可値: true, false)"
"MonitoringIntervalMsの値が範囲外です: 50 (推奨範囲: 100～60000)"
```

### A.7 移行手順

既存のハードコード箇所を修正する際の手順:

1. **Phase 1: 既定値の定義**
   - `Constants/DefaultValues.cs`を作成
   - 各項目の既定値を定数として定義

2. **Phase 2: 設定読み込みロジックの実装**
   - `ConfigurationLoader.cs`に`GetRequiredValue()`と`GetOptionalValue()`を実装
   - Excelファイル読み込み処理の統合

3. **Phase 3: 検証ロジックの実装**
   - `SettingsValidator.cs`に検証メソッドを追加
   - エラーメッセージの統一管理

4. **Phase 4: 既存コードの修正**
   - ハードコード箇所を設定ファイル読み込みに変更
   - 不要な項目（PlcName, Priority）の削除

5. **Phase 5: テスト**
   - 必須項目欠落時のエラーハンドリング確認
   - 既定値の動作確認
   - 検証ルールの動作確認

---

**最終更新**: 2025-11-28
