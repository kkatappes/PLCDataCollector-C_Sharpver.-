# インターフェース定義

## 概要

各機能の抽象化・疎結合化のためのインターフェース定義

---

## IConfigManager

### 機能概要

設定管理機能の抽象化

**実装クラス:**
- ConfigToFrameManager
- MultiConfigManager

**目的:**
- 設定読み込み処理の抽象化
- テスト容易性の向上
- 将来的な設定ソース変更への対応（XML, JSON, データベース等）

---

### メソッド定義

#### LoadConfigAsync
```csharp
Task<ConfigData> LoadConfigAsync(string configFileName = "appsettings.xlsx");
```
**機能：** 設定ファイルの非同期読み込み

**Input:** configFileName（設定ファイル名）

**Output:** ConfigData（設定データオブジェクト）

---

#### GetConfig<T>
```csharp
T GetConfig<T>(string configFileName = null) where T : class;
```
**機能：** 特定設定の取得（ジェネリック型対応）

**Input:** configFileName（オプション、軽量インスタンス用）

**Output:** 指定型の設定オブジェクト

---

## IPlcCommunicationManager

### 機能概要

PLC通信機能の抽象化

**実装クラス:**
- PlcCommunicationManager

**目的:**
- 通信処理の抽象化
- モック実装による完全オフラインテスト対応
- 複数PLC種類への拡張対応（三菱以外のPLC等）

---

### メソッド定義

#### ConnectAsync
```csharp
Task<ConnectionResponse> ConnectAsync(ConnectionConfig config, TimeoutConfig timeout);
```
**機能：** PLC接続の非同期実行

**Input:**
- ConnectionConfig（接続設定）
- TimeoutConfig（タイムアウト設定）

**Output:** ConnectionResponse（接続結果）

---

#### SendFrameAsync
```csharp
Task SendFrameAsync(string frameData);
```
**機能：** フレーム送信の非同期実行

**Input:** frameData（送信フレームデータ）

**Output:** void（例外スロー方式）

---

#### ReceiveResponseAsync
```csharp
Task<string> ReceiveResponseAsync();
```
**機能：** 応答受信の非同期実行

**Input:** なし

**Output:** 受信データ（16進数文字列）

---

#### DisconnectAsync
```csharp
Task<ConnectionStats> DisconnectAsync();
```
**機能：** PLC切断の非同期実行

**Input:** なし

**Output:** ConnectionStats（通信統計情報）

---

#### ProcessReceivedRawData
```csharp
ProcessedResponseData ProcessReceivedRawData(string rawData, ProcessedDeviceRequestInfo deviceInfo);
```
**機能：** 受信生データの基本後処理

**Input:**
- rawData（受信生データ）
- deviceInfo（デバイス要求情報）

**Output:** ProcessedResponseData（処理済みデータ）

---

#### ParseRawToStructuredData
```csharp
StructuredData ParseRawToStructuredData(ProcessedResponseData processedData);
```
**機能：** 構造化データ変換

**Input:** processedData（処理済みデータ）

**Output:** StructuredData（構造化データ）

---

## IDataWriter

### 機能概要

データ出力機能の抽象化

**実装クラス:**
- CsvFileWriter
- DataTransferManager（将来実装）
- DatabaseWriter（将来実装）

**目的:**
- 出力先の抽象化
- 複数出力形式への対応
- テスト容易性の向上

---

### メソッド定義

#### WriteAsync
```csharp
Task<WriteResult> WriteAsync(StructuredData data, DataProcessingConfig config);
```
**機能：** データ出力の非同期実行

**Input:**
- data（構造化データ）
- config（出力設定）

**Output:** WriteResult（出力結果）

---

## ILogger（Serilog準拠）

### 機能概要

ログ出力機能の抽象化

**実装ライブラリ:**
- Serilog（標準ログライブラリ）

**目的:**
- ログ処理の抽象化
- 複数ログ出力先への対応（ファイル、コンソール、ネットワーク等）
- ログレベル制御の統一

**設計方針:**
- Serilog標準のILoggerインターフェースを使用
- カスタムインターフェース定義は不要（Serilog依存）

---

## 設計方針

### 疎結合化
- インターフェースを通じた依存関係の抽象化
- 実装の切り替えが容易

### テスト容易性
- モック実装による単体テスト対応
- オフライン環境でのテスト実施

### 拡張性
- 新しい実装の追加が容易
- 既存コードへの影響最小化

### 保守性
- 責任分離による明確な境界
- インターフェース変更の影響範囲の明確化
